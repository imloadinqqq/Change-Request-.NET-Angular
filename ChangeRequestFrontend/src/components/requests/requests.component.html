<div class="background bg-gray-100 pt-20 pb-20">
  <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Change Requests</h2>

  <ul *ngIf="requests && requests.length; else noRequests" class="space-y-4 max-w-2xl mx-auto">
    <li *ngFor="let req of requests"
        class="bg-white shadow-md rounded-lg p-4 border border-gray-200">

      <p><span class="font-semibold text-gray-700">ID:</span> {{ req.Id }}</p>
      <p><span class="font-semibold text-gray-700">User ID of creator:</span> {{ req.UserId }}</p>
      <p><span class="font-semibold text-gray-700">Title:</span> {{ req.Title }}</p>
      <p><span class="font-semibold text-gray-700">Description:</span> {{ req.Description }}</p>

      <p>
        <span class="font-semibold text-gray-700">Status:</span>
        <span [ngClass]="{
          'text-green-600 font-bold': req.Status.toString() === 'Approved',
          'text-yellow-600 font-bold': req.Status.toString() === 'Pending',
          'text-red-600 font-bold': req.Status.toString() === 'Rejected',
          'text-blue-600 font-bold': req.Status.toString() === 'InProgress',
          'text-gray-600 font-bold': req.Status.toString() === 'Completed'
        }">
          {{ req.Status }}
        </span>
      </p>

      <p>
        <span class="font-semibold text-gray-700">Priority:</span>
        <span [ngClass]="{
          'text-green-600 font-bold': req.Priority.toString() === 'Low',
          'text-yellow-600 font-bold': req.Priority.toString() === 'Medium',
          'text-red-600 font-bold': req.Priority.toString() === 'High',
          'text-purple-600 font-bold': req.Priority.toString() === 'Critical'
        }">
          {{ req.Priority }}
        </span>
      </p>

      <p><span class="font-semibold text-gray-700">Target Date:</span> {{ req['Target Date'] || 'N/A' }}</p>
      <p><span class="font-semibold text-gray-700">Approved By:</span> {{ req['Id of Approver'] || 'Pending' }}</p>

      <div class="mt-3" *ngIf="userType === 'Admin' && req.Status.toString() === 'Pending'">
        <app-approve-change-request-button
          [requestId]="req.Id!"
          (approved)="loadRequests()">
        </app-approve-change-request-button>
      </div>
      <div class="mt-3" *ngIf="userType === 'Admin' && req.Status.toString() === 'Pending'">
        <app-reject-change-request-button
          [requestId]="req.Id!"
          (rejected)="loadRequests()">
        </app-reject-change-request-button>
      </div>
      <div class="mt-3" *ngIf="userType === 'Admin' || userType === 'Supervisor' && req.Status.toString() !== 'Pending'">
        <app-update-request-status-toggle-button
          [requestId]="req.Id"
          (statusChanged)="loadRequests()">
        </app-update-request-status-toggle-button>
      </div>
    </li>
  </ul>

  <ng-template #noRequests>
    <p class="text-center text-gray-500 mt-6">No change requests available.</p>
  </ng-template>

  <div class="mt-6 max-w-2xl w-full mx-auto">
    <app-dashboardbutton></app-dashboardbutton>
  </div>

</div>
